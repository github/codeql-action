name: "RuboCop multi-language"
description: "Tests using RuboCop to analyze a multi-language repository and then using the CodeQL Action to upload the resulting SARIF"
# This check doesn't use CodeQL, so the `version` matrix variable is unused.
versions: ["default"]
steps:
  - name: Set up Ruby
    uses: ruby/setup-ruby@80740b3b13bf9857e28854481ca95a84e78a2bdf # v1.284.0
    with:
      ruby-version: 2.6
  - name: Install Code Scanning integration
    run: bundle add code-scanning-rubocop --version 0.3.0 --skip-install
  - name: Install dependencies
    run: bundle install
  - name: RuboCop run
    run: |
      bash -c "
        bundle exec rubocop --require code_scanning --format CodeScanning::SarifFormatter -o rubocop.sarif
        [[ $? -ne 2 ]]
      "
  - uses: ./../action/upload-sarif
    with:
      sarif_file: rubocop.sarif
