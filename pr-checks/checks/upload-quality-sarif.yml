name: "Upload-sarif: code quality endpoint"
description: "Checks that uploading SARIFs to the code quality endpoint works"
versions: ["default"]
installGo: true
steps:
  - uses: ./../action/init
    with:
      tools: ${{ steps.prepare-test.outputs.tools-url }}
      languages: csharp,java,javascript,python
      analysis-kinds: code-quality
  - name: Build code
    run: ./build.sh
  # Generate some SARIF we can upload with the upload-sarif step
  - uses: ./../action/analyze
    with:
      ref: 'refs/heads/main'
      sha: '5e235361806c361d4d3f8859e3c897658025a9a2'
      upload: never
  - uses: ./../action/upload-sarif
    id: upload-sarif
    with:
      ref: 'refs/heads/main'
      sha: '5e235361806c361d4d3f8859e3c897658025a9a2'
  - name: "Check output from `upload-sarif` step"
    if: fromJSON(steps.upload-sarif.sarif-ids)[0].analysis != 'code-quality'
    run: exit 1
